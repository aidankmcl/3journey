import{A as e,H as t,k as n,lt as r,ot as i,z as a}from"./three.module-LFc9tN89.js";var o=class extends n{constructor(e){super(e),this.type=t}parse(n){let r=function(e,t){switch(e){case 1:throw Error(`THREE.HDRLoader: Read Error: `+(t||``));case 2:throw Error(`THREE.HDRLoader: Write Error: `+(t||``));case 3:throw Error(`THREE.HDRLoader: Bad File Format: `+(t||``));default:case 4:throw Error(`THREE.HDRLoader: Memory Error: `+(t||``))}},i=function(e,t,n){t||=1024;let r=e.pos,i=-1,a=0,o=``,s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));for(;0>(i=s.indexOf(`
`))&&a<t&&r<e.byteLength;)o+=s,a+=s.length,r+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return-1<i?(!1!==n&&(e.pos+=a+i+1),o+s.slice(0,i)):!1},o=function(e){let t=/^#\?(\S+)/,n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,s=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,c={valid:0,string:``,comments:``,programtype:`RGBE`,format:``,gamma:1,exposure:1,width:0,height:0},l,u;for((e.pos>=e.byteLength||!(l=i(e)))&&r(1,`no header found`),(u=l.match(t))||r(3,`bad initial token`),c.valid|=1,c.programtype=u[1],c.string+=l+`
`;l=i(e),!1!==l;){if(c.string+=l+`
`,l.charAt(0)===`#`){c.comments+=l+`
`;continue}if((u=l.match(n))&&(c.gamma=parseFloat(u[1])),(u=l.match(a))&&(c.exposure=parseFloat(u[1])),(u=l.match(o))&&(c.valid|=2,c.format=u[1]),(u=l.match(s))&&(c.valid|=4,c.height=parseInt(u[1],10),c.width=parseInt(u[2],10)),c.valid&2&&c.valid&4)break}return c.valid&2||r(3,`missing format specifier`),c.valid&4||r(3,`missing image size specifier`),c},s=function(e,t,n){let i=t;if(i<8||i>32767||e[0]!==2||e[1]!==2||e[2]&128)return new Uint8Array(e);i!==(e[2]<<8|e[3])&&r(3,`wrong scanline width`);let a=new Uint8Array(4*t*n);a.length||r(4,`unable to allocate buffer space`);let o=0,s=0,c=4*i,l=new Uint8Array(4),u=new Uint8Array(c),d=n;for(;d>0&&s<e.byteLength;){s+4>e.byteLength&&r(1),l[0]=e[s++],l[1]=e[s++],l[2]=e[s++],l[3]=e[s++],(l[0]!=2||l[1]!=2||(l[2]<<8|l[3])!=i)&&r(3,`bad rgbe scanline format`);let t=0,n;for(;t<c&&s<e.byteLength;){n=e[s++];let i=n>128;if(i&&(n-=128),(n===0||t+n>c)&&r(3,`bad scanline data`),i){let r=e[s++];for(let e=0;e<n;e++)u[t++]=r}else u.set(e.subarray(s,s+n),t),t+=n,s+=n}let f=i;for(let e=0;e<f;e++){let t=0;a[o]=u[e+t],t+=i,a[o+1]=u[e+t],t+=i,a[o+2]=u[e+t],t+=i,a[o+3]=u[e+t],o+=4}d--}return a},c=function(e,t,n,r){let i=2**(e[t+3]-128)/255;n[r+0]=e[t+0]*i,n[r+1]=e[t+1]*i,n[r+2]=e[t+2]*i,n[r+3]=1},l=function(t,n,r,i){let a=2**(t[n+3]-128)/255;r[i+0]=e.toHalfFloat(Math.min(t[n+0]*a,65504)),r[i+1]=e.toHalfFloat(Math.min(t[n+1]*a,65504)),r[i+2]=e.toHalfFloat(Math.min(t[n+2]*a,65504)),r[i+3]=e.toHalfFloat(1)},u=new Uint8Array(n);u.pos=0;let d=o(u),f=d.width,p=d.height,m=s(u.subarray(u.pos),f,p),h,g,_;switch(this.type){case a:_=m.length/4;let e=new Float32Array(_*4);for(let t=0;t<_;t++)c(m,t*4,e,t*4);h=e,g=a;break;case t:_=m.length/4;let n=new Uint16Array(_*4);for(let e=0;e<_;e++)l(m,e*4,n,e*4);h=n,g=t;break;default:throw Error(`THREE.HDRLoader: Unsupported type: `+this.type)}return{width:f,height:p,data:h,header:d.string,gamma:d.gamma,exposure:d.exposure,type:g}}setDataType(e){return this.type=e,this}load(e,n,o,s){function c(e,o){switch(e.type){case a:case t:e.colorSpace=r,e.minFilter=i,e.magFilter=i,e.generateMipmaps=!1,e.flipY=!0;break}n&&n(e,o)}return super.load(e,c,o,s)}};export{o as t};